AjaxSolr=function(){},AjaxSolr.Class=function(){},AjaxSolr.Class.extend=function(t){var e=this,r=function(r){AjaxSolr.extend(this,new e(r),t,r)};return r.extend=this.extend,r},AjaxSolr.size=function(t){var e=0;for(var r in t)t.hasOwnProperty(r)&&e++;return e},AjaxSolr.equals=function(t,e){if(AjaxSolr.isArray(t)&&AjaxSolr.isArray(e)){if(t.length!==e.length)return!1;for(var r=0,a=t.length;r<a;r++)if(t[r]!==e[r])return!1;return!0}return AjaxSolr.isRegExp(t)&&AjaxSolr.isString(e)?e.match(t):AjaxSolr.isRegExp(e)&&AjaxSolr.isString(t)?t.match(e):t===e},AjaxSolr.inArray=function(t,e){if(e)for(var r=0,a=e.length;r<a;r++)if(AjaxSolr.equals(e[r],t))return r;return-1},AjaxSolr.flatten=function(t){for(var e=[],r=0,a=t.length;r<a;r++)e=e.concat(AjaxSolr.isArray(t[r])?AjaxSolr.flatten(t[r]):t[r]);return e},AjaxSolr.grep=function(t,e){for(var r=[],a=0,n=t.length;a<n;a++)!1==!e(t[a],a)&&r.push(t[a]);return r},AjaxSolr.compact=function(t){return AjaxSolr.grep(t,(function(t){return t.toString()}))},AjaxSolr.isArray=function(t){return null!=t&&"object"==typeof t&&"splice"in t&&"join"in t},AjaxSolr.isRegExp=function(t){return null!=t&&("object"==typeof t||"function"==typeof t)&&"ignoreCase"in t},AjaxSolr.isString=function(t){return null!=t&&"string"==typeof t},AjaxSolr.theme=function(t){if(!AjaxSolr.theme[t]&&null!=AjaxSolr.theme.prototype[t]){for(var e=1,r=[];e<arguments.length;e++)r.push(arguments[e]);return(AjaxSolr.theme[t]||AjaxSolr.theme.prototype[t]).apply(this,r)}console.log('Theme function "'+t+'" is not defined.')},AjaxSolr.extend=function(){for(var t,e=arguments[0]||{},r=1,a=arguments.length;r<a;r++)if(null!=(t=arguments[r]))for(var n in t){var i=e[n],s=t[n];e!==s&&(s&&"object"==typeof s&&!s.nodeType?e[n]=AjaxSolr.extend(i||(null!=s.length?[]:{}),s):s&&i&&"function"==typeof s&&"function"==typeof i?e[n]=function(t,e){return function(){var r,a=this._super;return this._super=t,r=e.apply(this,arguments),this._super=a,r}}(i,s):void 0!==s&&(e[n]=s))}return e},AjaxSolr.parseStringList=function(t){var e,r=/("[^"]*"|[^ ]*)?(.*)/,a=[];do{e=r.exec(t.trim()),a.push(e[1]),t=e[2]}while(t.trim());return a},AjaxSolr.Parameter=AjaxSolr.Class.extend({name:null,value:null,locals:{},val:function(t){if(void 0===t)return this.value;this.value=t},local:function(t,e){if(void 0===e)return this.locals[t];this.locals[t]=e},remove:function(t){delete this.locals[t]},string:function(){var t=[];for(var e in this.locals)this.locals[e]&&t.push(e+"="+encodeURIComponent(this.locals[e]));var r=t.length?"{!"+t.join("%20")+"}":"";return this.value?this.name+"="+r+this.valueString(this.value):"q"==this.name&&r?"q.alt="+r+encodeURIComponent("*:*"):""},parseString:function(t){var e=t.match(/^([^=]+)=(?:\{!([^\}]*)\})?(.*)$/);if(e){for(var r;r=/([^\s=]+)=(\S*)/g.exec(decodeURIComponent(e[2]));)this.locals[r[1]]=decodeURIComponent(r[2]),e[2]=e[2].replace(r[0],"");"q.alt"==e[1]?this.name="q":(this.name=e[1],this.value=this.parseValueString(e[3]))}},valueString:function(t){return t=AjaxSolr.isArray(t)?t.join(","):t,encodeURIComponent(t)},parseValueString:function(t){return-1==(t=decodeURIComponent(t)).indexOf(",")?t:t.split(",")}}),AjaxSolr.Parameter.escapeValue=function(t){return!t.match(/[ :]/)||t.match(/[\[\{]\S+ TO \S+[\]\}]/)||t.match(/^["\(].*["\)]$/)?t:'"'+t+'"'},AjaxSolr.ParameterStore=AjaxSolr.Class.extend({exposed:[],hidden:[],params:{},manager:null,init:function(){},isMultiple:function(t){return t.match(/^(?:bf|bq|facet\.date|facet\.date\.other|facet\.date\.include|facet\.field|facet\.pivot|facet\.range|facet\.range\.other|facet\.range\.include|facet\.query|fq|group\.field|group\.func|group\.query|pf|qf)$/)},isHidden:function(t){"object"==typeof t&&(t=t.string()),t=decodeURIComponent(t);for(var e=0,r=this.hidden.length;e<r;e++)if(this.hidden[e]==t)return!0;return!1},get:function(t){if(void 0===this.params[t]){var e=new AjaxSolr.Parameter({name:t});this.isMultiple(t)?this.params[t]=[e]:this.params[t]=e}return this.params[t]},values:function(t){if(void 0!==this.params[t]){if(this.isMultiple(t)){for(var e=[],r=0,a=this.params[t].length;r<a;r++)e.push(this.params[t][r].val());return e}return[this.params[t].val()]}return[]},add:function(t,e){if(void 0===e&&(e=new AjaxSolr.Parameter({name:t})),this.isMultiple(t))if(void 0===this.params[t])this.params[t]=[e];else{if(-1!=AjaxSolr.inArray(e.val(),this.values(t)))return!1;this.params[t].push(e)}else this.params[t]=e;return e},remove:function(t,e){void 0===e?delete this.params[t]:(this.params[t].splice(e,1),0==this.params[t].length&&delete this.params[t])},find:function(t,e){if(void 0!==this.params[t]){if(this.isMultiple(t)){for(var r=[],a=0,n=this.params[t].length;a<n;a++)AjaxSolr.equals(this.params[t][a].val(),e)&&r.push(a);return!!r.length&&r}if(AjaxSolr.equals(this.params[t].val(),e))return t}return!1},addByValue:function(t,e,r){if(void 0===r&&(r={}),this.isMultiple(t)&&AjaxSolr.isArray(e)){for(var a=[],n=0,i=e.length;n<i;n++)a.push(this.add(t,new AjaxSolr.Parameter({name:t,value:e[n],locals:r})));return a}return this.add(t,new AjaxSolr.Parameter({name:t,value:e,locals:r}))},removeByValue:function(t,e){var r=this.find(t,e);if(r)if(AjaxSolr.isArray(r))for(var a=r.length-1;a>=0;a--)this.remove(t,r[a]);else this.remove(r);return r},string:function(){var t,e,r=[];for(var a in this.params)if(this.isMultiple(a))for(var n=0,i=this.params[a].length;n<i;n++)(t=this.params[a][n].string())&&r.push(t);else(t=this.params[a].string())&&r.push(t);for(n=0,i=this.hidden.length;n<i;n++)(e=new AjaxSolr.Parameter).parseString(this.hidden[n]),r.push(e.string());return AjaxSolr.compact(r).join("&")},parseString:function(t){for(var e=t.split("&"),r=0,a=e.length;r<a;r++)if(e[r]){var n=new AjaxSolr.Parameter;n.parseString(e[r]),n.name&&this.add(n.name,n)}},exposedString:function(){for(var t,e=[],r=0,a=this.exposed.length;r<a;r++)if(void 0!==this.params[this.exposed[r]])if(this.isMultiple(this.exposed[r]))for(var n=0,i=this.params[this.exposed[r]].length;n<i;n++)(t=this.params[this.exposed[r]][n].string())&&!this.isHidden(t)&&e.push(t);else(t=this.params[this.exposed[r]].string())&&!this.isHidden(t)&&e.push(t);return AjaxSolr.compact(e).join("&")},exposedReset:function(){for(var t,e=0,r=this.exposed.length;e<r;e++)this.remove(this.exposed[e]);for(e=0,r=this.hidden.length;e<r;e++)(t=new AjaxSolr.Parameter).parseString(this.hidden[e]),this.add(t.name,t)},load:function(t){void 0===t&&(t=!0),t&&this.exposedReset(),this.parseString(this.storedString())},save:function(){},storedString:function(){return""}}),AjaxSolr.ParameterHashStore=AjaxSolr.ParameterStore.extend({interval:250,intervalId:null,hash:"",init:function(){this.exposed.length&&(this.intervalId=window.setInterval(this.intervalFunction(this),this.interval))},save:function(){this.hash=this.exposedString(),window.location.hash=this.hash},storedString:function(){var t=window.location.href.indexOf("#");return-1==t?"":window.location.href.substr(t+1)},intervalFunction:function(t){return function(){var e=t.storedString();t.hash!=e&&decodeURIComponent(t.hash)!=decodeURIComponent(e)&&(t.load(),t.manager.doRequest())}}}),AjaxSolr.AbstractManager=AjaxSolr.Class.extend({solrUrl:"http://localhost:8983/solr/",proxyUrl:null,servlet:"select",response:{},widgets:{},store:null,initialized:!1,init:function(){for(var t in this.initialized=!0,null===this.store&&this.setStore(new AjaxSolr.ParameterStore),this.store.load(!1),this.widgets)this.widgets[t].init();this.store.init()},setStore:function(t){t.manager=this,this.store=t},addWidget:function(t){t.manager=this,this.widgets[t.id]=t},doRequest:function(t,e){for(var r in!1===this.initialized&&this.init(),void 0!==t&&this.store.get("start").val(t),void 0===e&&(e=this.servlet),this.store.save(),this.widgets)this.widgets[r].beforeRequest();this.executeRequest(e)},executeRequest:function(t){throw"Abstract method executeRequest must be overridden in a subclass."},handleResponse:function(t){for(var e in this.response=t,this.widgets)this.widgets[e].afterRequest()}}),AjaxSolr.AbstractWidget=AjaxSolr.Class.extend({id:null,target:null,manager:null,start:void 0,servlet:void 0,init:function(){},beforeRequest:function(){},afterRequest:function(){},doRequest:function(t,e){this.manager.doRequest(void 0!==t?t:this.start,void 0!==e?e:this.servlet)}}),AjaxSolr.AbstractFacetWidget=AjaxSolr.AbstractWidget.extend({start:0,field:null,multivalue:!0,union:!1,tag:null,key:null,ex:null,facetType:null,queries:[],init:function(){this.initStore()},initStore:function(){var t,e=["facet.prefix","facet.sort","facet.limit","facet.offset","facet.mincount","facet.missing","facet.method","facet.enum.cache.minDf"];switch(this.manager.store.addByValue("facet",!0),this.getFacetType()){case"facet_fields":t=this.manager.store.addByValue("facet.field",this.field);break;case"facet_dates":t=this.manager.store.addByValue("facet.date",this.field),e=e.concat(["facet.date.start","facet.date.end","facet.date.gap","facet.date.hardend","facet.date.other","facet.date.include"]);break;case"facet_queries":if(null==this.queries)throw"no queries for field "+this.field;for(var r=0,a=this.queries.length;r<a;r++)t=this.manager.store.addByValue("facet.query",this.queries[r].value),this.queries[r].key&&(t.local("key","'"+this.queries[r].key+"'"),this.ex&&t.local("ex",this.ex));t=null;break;case"facet_ranges":t=this.manager.store.addByValue("facet.range",this.field),e=e.concat(["facet.range.start","facet.range.end","facet.range.gap","facet.range.hardend","facet.range.other","facet.range.include"])}t&&(this.key&&t.local("key",this.key),this.ex&&t.local("ex",this.ex));for(r=0,a=e.length;r<a;r++)void 0!==this[e[r]]&&this.manager.store.addByValue("f."+this.field+"."+e[r],this[e[r]])},isEmpty:function(){return!this.manager.store.find("fq",new RegExp("^-?"+this.field+":"))},set:function(t,e){return this.changeSelection((function(){var r=this.manager.store.removeByValue("fq",new RegExp("^-?"+this.field+":")),a=this.manager.store.addByValue("fq",this.fq(t,e));return a&&this.tag&&a.local("tag",this.tag),r||a}))},add:function(t,e){return this.changeSelection((function(){var r=this.manager.store.addByValue("fq",this.fq(t,e));return r&&this.tag&&r.local("tag",this.tag),r}))},append:function(t,e){return this.changeSelection((function(){var r,a,n;return t=AjaxSolr.Parameter.escapeValue(t),(r=this.getParams())?(n=this.getQueryValues(r),a=r[0],AjaxSolr.inArray(t,n)<0&&(n.push(t),a.val(this.fq("("+n.join(" ")+")",e)),!0)):((a=this.manager.store.addByValue("fq",this.fq("("+t+")",e)))&&this.tag&&(a.local("tag",this.tag),a.local("q.op","OR")),!0)}))},remove:function(t,e){return this.changeSelection((function(){var r,a;if(this.multivalue&&this.union&&(t=AjaxSolr.Parameter.escapeValue(t),r=this.getParams()))return(a=this.getQueryValues(r).filter((function(e,r){return e!=t}))).length>0?(r[0].val(this.fq("("+a.join(" ")+")",e)),!0):this.manager.store.removeByValue("fq",this.fq("("+t+")",e));return this.manager.store.removeByValue("fq",this.fq(t,e))}))},clear:function(){return this.changeSelection((function(){return this.manager.store.removeByValue("fq",new RegExp("^-?"+this.field+":"))}))},changeSelection:function(t){return changed=t.apply(this),changed&&this.afterChangeSelection(),changed},afterChangeSelection:function(){},getFacetType:function(){if(void 0!==this.facetType)return this.facetType;for(var t in this.manager.response.facet_counts)if(void 0!==this.manager.response.facet_counts[t][this.field])return this.facetType=t,t},getFacetCounts:function(){var t=this.getFacetType();switch(t){case"facet_fields":default:return this.getFacetCountsFlat(t);case"facet_dates":return this.getFacetCountsArrarr(t);case"facet_queries":return this.getFacetCountsMap(t);case"facet_ranges":return this.getFacetCountsRange(t)}},getFacetCountsMap:function(t){var e=[],r="facet_queries"!=t&&this.field?this.manager.response.facet_counts[t][this.field]:this.manager.response.facet_counts[t];for(var a in r)e.push({facet:a,count:parseInt(r[a])});return e},getFacetCountsArrarr:function(t){for(var e=[],r=this.field?this.manager.response.facet_counts[t][this.field]:this.manager.response.facet_counts[t],a=0,n=r.length;a<n;a++)e.push({facet:r[a][0],count:parseInt(r[a][1])});return e},getFacetCountsFlat:function(t){var e=[],r=this.manager.response.facet_counts;if(void 0!==r&&void 0!==r[t]&&void 0!==r[t][this.field])for(var a=0,n=(r=r[t][this.field]).length;a<n;a+=2)e.push({facet:r[a],count:parseInt(r[a+1])});return e},getFacetCountsRange:function(t){var e=[],r=this.manager.response.facet_counts;if(void 0!==r&&void 0!==r[t]&&void 0!==r[t][this.field]&&void 0!==r[t][this.field].counts)for(var a=0,n=(r=r[t][this.field].counts).length;a<n;a+=2)e.push({facet:r[a],count:parseInt(r[a+1])});return e},clickHandler:function(t){var e=this,r=this.multivalue?this.union?"append":"add":"set";return function(){return e[r].call(e,t)&&e.doRequest(0),!1}},unclickHandler:function(t){var e=this;return function(){return e.remove(t)&&e.doRequest(0),!1}},fq:function(t,e){return/^[^\[].*:.*$/.test(t)?(e?"-":"")+AjaxSolr.Parameter.escapeValue(t):(e?"-":"")+this.field+":"+AjaxSolr.Parameter.escapeValue(t)},getParams:function(){var t=this.manager.store.find("fq",new RegExp("^-?"+this.field+":")),e=[];for(var r in t)e.push(this.manager.store.params.fq[t[r]]);return 0!=e.length&&e},getQueryValues:function(t){var e,r,a,n=this.union?new RegExp("^-?"+this.field+":\\((.*)\\)"):new RegExp("^-?"+this.field+":(.*)"),i=[];if(t)for(a in t)e=t[a],(r=n.exec(e.val()))&&(r=r[1],this.union?i=AjaxSolr.parseStringList(r).slice():i.push(r));return i},inQuery:function(t){return AjaxSolr.inArray(AjaxSolr.Parameter.escapeValue(t),this.getQueryValues(this.getParams()))}}),AjaxSolr.AbstractSpatialWidget=AjaxSolr.AbstractWidget.extend({set:function(t){this.manager.store.get("q").local("type","spatial"),this.manager.store.get("q").local("lat",t.lat),this.manager.store.get("q").local("long",t.lng),this.manager.store.get("q").local("radius",t.radius),void 0!==t.unit&&this.manager.store.get("q").local("unit",t.unit),void 0!==t.calc&&this.manager.store.get("q").local("calc",t.calc),void 0!==t.threadCount&&this.manager.store.get("q").local("threadCount",t.threadCount)},clear:function(){this.manager.store.get("q").remove("type"),this.manager.store.get("q").remove("lat"),this.manager.store.get("q").remove("long"),this.manager.store.get("q").remove("radius"),this.manager.store.get("q").remove("unit"),this.manager.store.get("q").remove("calc"),this.manager.store.get("q").remove("threadCount")}}),AjaxSolr.AbstractSpellcheckWidget=AjaxSolr.AbstractWidget.extend({suggestions:[],afterRequest:function(){var t;if(this.suggestions=[],this.manager.response.spellcheck&&this.manager.response.spellcheck.collations){for(var e=0,r=(t=this.manager.response.spellcheck.collations).length;e<r;e++)"collation"==t[e]&&(e++,this.suggestions.push(t[e]));this.suggestions.length&&this.handleSuggestions(this.manager.response)}},handleSuggestions:function(){}}),AjaxSolr.AbstractTextWidget=AjaxSolr.AbstractWidget.extend({start:0,set:function(t){return this.changeSelection((function(){this.manager.store.get("q").val(t)}))},clear:function(){return this.changeSelection((function(){this.manager.store.remove("q")}))},changeSelection:function(t){var e=this.manager.store.get("q").val();t.apply(this);var r=this.manager.store.get("q").val();return r!==e&&this.afterChangeSelection(r),r!==e},afterChangeSelection:function(t){},unclickHandler:function(){var t=this;return function(){return t.clear()&&t.doRequest(),!1}},clickHandler:function(t){var e=this;return function(){return e.set(t)&&e.doRequest(),!1}}}),AjaxSolr.Manager=AjaxSolr.AbstractManager.extend({executeRequest:function(t,e,r){var a=this;e=e||this.store.string(),r=r||function(t){a.handleResponse(t)},this.proxyUrl?this.xhr=jQuery.post(this.proxyUrl,{query:e},r,"json"):this.xhr=jQuery.ajax({url:this.solrUrl+t+"?"+e+"&wt=json",dataType:"json",success:r,error:function(t,e,r){if("abort"!==e)throw e}})}}),String.prototype.trim=function(){return this.replace(/^ +/,"").replace(/ +$/,"")},String.prototype.htmlEscape=function(){return this.replace(/"/g,"&quot;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/&/g,"&amp;")},String.prototype.escapeOnce=function(){return this.replace(/"/g,"&quot;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/&(?!([a-zA-Z]+|#\d+);)/g,"&amp;")},String.prototype.sanitizeToId=function(){return this.replace(/\]/g,"").replace(/[^-a-zA-Z0-9:.]/g,"_")},String.prototype.endsWith=function(t){return this.substring(this.length-t.length)==t},String.prototype.startsWith=function(t){return this.substring(0,t.length)==t},String.prototype.strtr=function(t){var e=this;for(var r in t)e=e.replace(new RegExp(r,"g"),t[r]);return e},function(t){AjaxSolr.Helpers={getUniqueID:function(){var t,e=(new Date).getTime().toString(32);for(t=0;t<5;t++)e+=Math.floor(65535*Math.random()).toString(32);return e},build:function(e){t.fn["solr"+e]=function(r,a){return this.each((function(){var n,i=t(this),s=i.data("field"),o=i.attr("id");void 0===o&&(o=AjaxSolr.Helpers.getUniqueID(),i.attr("id",o)),n=new AjaxSolr[e]({id:o,target:"#"+o,field:s,options:a}),i.data("widget",n),r.addWidget(n)}))}}}}(jQuery);var _=function(t,e){e=e||"default";var r=AjaxSolr.Dicts[e];return void 0!==r?r.get(t):t};!function(t){AjaxSolr.Dictionary=function(e,r){var a=this,n=t(e),i=t.extend({},n.data(),r);a.id=n.attr("id")||i.id||"default",a.data={},a.container=n,a.opts=i,a.init()},AjaxSolr.Dictionary.prototype.init=function(){var e=this;e.text=e.container.text(),e.data=t.parseJSON(e.text)},AjaxSolr.Dictionary.prototype.get=function(t){var e,r,a=this;return t=t.replace(/^\s*(.*?)\s*$/,"$1"),void 0!==(e=a.data[t])?e:void 0===a.opts.subDictionary?t:void 0!==(r=AjaxSolr.Dicts[a.opts.subDictionary])?r.get(t):t},AjaxSolr.Dictionary.prototype.set=function(t,e){t=t.replace(/^\s*(.*?)\s*$/,"$1"),e=e.replace(/^\s*(.*?)\s*$/,"$1"),this.data[t]=e},t((function(){var e;AjaxSolr.Dicts={},t(".solrDictionary").each((function(){var t=new AjaxSolr.Dictionary(this);e||(e=t),AjaxSolr.Dicts[t.id]=t})),AjaxSolr.Dicts.default=AjaxSolr.Dicts.default||e}))}(jQuery);
