"use strict";!function(t){t.widget("solr.autosuggest",t.ui.autocomplete,{options:{thumbnailBase:null,delay:500,minLength:3,extraParams:{fields:"topic_search,container_title,title,type,thumbnail,icon,url,field_Telephone_s,field_Phone_s,field_Mobile_s"},limits:{global:3,persons:3,topics:3,other:3},position:{my:"right top",at:"right+5 bottom+11",collision:"none"},itemData:{phoneSchema:"tel"},templates:{persons:"<li class='ui-autosuggest-item {{:group}} {{:isFirst}} {{:isLast}}'>{{:header}}{{if phoneNumber}}<a class='ui-autosuggest-phone-number fa fa-phone i18n' href='{{:phoneSchema}}:{{:phoneNumber}}'></a>{{/if}}<a href='{{:url}}' class='ui-autosuggest-link'><table class='foswikiNullTable'><tr><th><div>{{:thumbnail}}</div></th><td>{{:title}}<div class='foswikiGrayText'>{{:phoneNumber}}</div></td></tr></table></a></li>",other:"<li class='ui-autosuggest-item {{:group}} {{:isFirst}} {{:isLast}}'>{{:header}}<a href='{{:url}}' class='ui-autosuggest-link'><table class='foswikiNullTable'><tr><th><div>{{:thumbnail}}</div></th><td>{{:title}}<div class='foswikiGrayText'>{{:container_title}}</div></td></tr></table></a></li>",default:"<li class='ui-autosuggest-item {{:group}} {{:isFirst}} {{:isLast}}'>{{:header}}<a href='{{:url}}' class='ui-autosuggest-link'><table class='foswikiNullTable'><tr><th><div>{{:thumbnail}}</div></th><td>{{:title}}<div class='foswikiGrayText'>{{:container_title}}</div></td></tr></table></a></li>",header:"<div class='ui-autosuggest-title {{:group}}'>{{:title}}</div>",footer:"<li class='ui-autosuggest-item ui-autosuggest-more'><a class='ui-autosuggest-link' href='{{:moreUrl}}'>{{:title}}</a></li>"},focus:function(){return!1},select:function(e,i){return(13===e.keyCode||t.browser.msie)&&(window.location.href=i.item.url),!1},cache:!0,source:null,menuClass:null},_init:function(){var t=this,e=t.menu.element;t.options.thumbnailBase=foswiki.getScriptUrl("rest","ImagePlugin","resize",{size:48,crop:"north"}),e.addClass("ui-autosuggest").removeClass("ui-autocomplete"),t.options.menuClass&&e.addClass(t.options.menuClass),t.options.extraParams.limit=t.options.limits.global,t.templates={}},_initSource:function(){var e=this;e.cache={},e.options.source=e.options.source||foswiki.getScriptUrl("rest","SolrPlugin","autosuggest"),e.source=function(i,s){var a=i.term.replace(/(^\s+)|(\s+$)/g,""),o=a;i.term=a,void 0!==e.options.extraParams&&t.each(e.options.extraParams,(function(t,s){var a="function"==typeof s?s(e):s;i[t]=a,o+=";"+t+"="+a})),i.topic=foswiki.getPreference("WEB")+"."+foswiki.getPreference("TOPIC"),e.options.cache&&o in e.cache?s(e.cache[o]):(e.xhr&&e.xhr.abort(),e.xhr=t.ajax({url:e.options.source,data:i,dataType:"json",success:function(t,i,a){e.options.cache&&(e.cache[o]=t),a===e.xhr&&s(t)},error:function(){s([])}}))}},_getTemplate:function(e){var i,s=this,a=s.templates[e];return void 0===a&&void 0!==(i=s.options.templates[e])&&(a=s.templates[e]=t.templates(i)),a},_renderMenu:function(e,i){var s=this;t.each(i,(function(i,a){var o,l=a.docs.length;l&&(o=s._getTemplate("header").render({group:a.group,title:t.i18n(a.group)}),t.each(a.docs,(function(t,i){t<s.options.limits[a.group]&&(i.phoneNumber=i.field_Telephone_s||i.field_Phone_s||i.field_Mobile_s,i.group=a.group,0===t?(i.isFirst="ui-autosuggest-first-in-group",i.header=o):(i.isFirst="",i.header=""),t===s.options.limits.global-1||t===l-1?i.isLast="ui-autosuggest-last-in-group":i.isLast="",s._renderItemData(e,i))})),t(s._getTemplate("footer").render({moreUrl:a.moreUrl,title:t.i18n("... more")})).data("ui-autocomplete-item",{url:a.moreUrl}).appendTo(e))}))},_renderItem:function(e,i){var s,a=this,o=a._getTemplate(i.group)||a._getTemplate("default");return i._done||(i._done=!0,void 0!==i.thumbnail?/^ma-/.test(i.thumbnail)?i.thumbnail="<i class='icon ma "+i.icon+"' />":/^fa-/.test(i.thumbnail)?i.thumbnail="<i class='icon fa "+i.icon+"' />":(/^(\/|https?:)/.test(i.thumbnail)?i.thumbnailUrl=a.options.thumbnailBase+"&file="+i.thumbnail:/\.svgz?$/.test(i.thumbnail)?i.thumbnailUrl=foswiki.getPubUrlPath(i.web,i.topic,i.thumbnail):i.thumbnailUrl=a.options.thumbnailBase+"&topic="+i.web+"."+i.topic+"&file="+i.thumbnail,i.thumbnail="<img class='thumbnail' width='48' src='"+i.thumbnailUrl+"' />"):i.thumbnail="",t.extend(i,a.options.itemData)),s=t(o.render(i)).data("ui-autocomplete-item",i),e.append(s)},_normalize:function(t){return t}})}(jQuery);
